2025-09-25 11:33:07,861 - app - INFO - ✓ All required environment variables present (web-only architecture)
2025-09-25 11:33:08,337 - app - INFO - ✓ Session cookies configured for localhost (development, non-secure)
2025-09-25 11:33:08,337 - app - INFO - ✓ CORS configured for development: ['http://localhost:5000', 'http://localhost:5000', 'https://*.finbrain.app', 'https://finbrain.app']
2025-09-25 11:33:08,896 - utils.rate_limiting - INFO - Rate limiting configured with Redis storage
2025-09-25 11:33:09,067 - utils.ai_adapter_v2 - INFO - Production AI Adapter initialized: enabled=True, provider=gemini [USER_ISOLATED]
2025-09-25 11:33:09,075 - utils.ai_limiter - INFO - Advanced AI Limiter initialized: redis=False, global_limit=120/min, per_psid_limit=4/min
2025-09-25 11:33:09,114 - root - WARNING - PRODUCTION_ROUTER_INIT file=/home/runner/workspace/utils/production_router.py sha=bb798ed704ac
2025-09-25 11:33:09,120 - finbrain.router - INFO - Production Router initialized with bulletproof RL-2 and flag-gated AI
2025-09-25 11:33:09,123 - app - INFO - [BOOT] Canonical router loaded. SHA=cc72dd77e8d8
2025-09-25 11:33:09,335 - utils.safe_db_init - INFO - === DATABASE SCHEMA VALIDATION (READ-ONLY) ===
2025-09-25 11:33:15,319 - utils.safe_db_init - INFO - === EXISTING SCHEMA CHECK ===
2025-09-25 11:33:15,319 - utils.safe_db_init - INFO - inference_snapshots: 2 indexes
2025-09-25 11:33:15,325 - utils.safe_db_init - DEBUG -   - inference_snapshots_cc_id_key1
2025-09-25 11:33:15,331 - utils.safe_db_init - DEBUG -   - inference_snapshots_pkey1
2025-09-25 11:33:15,332 - utils.safe_db_init - INFO - transactions_effective: 6 indexes
2025-09-25 11:33:15,332 - utils.safe_db_init - DEBUG -   - idx_transactions_effective_raw_expense
2025-09-25 11:33:15,335 - utils.safe_db_init - DEBUG -   - idx_transactions_effective_tx_id
2025-09-25 11:33:15,335 - utils.safe_db_init - DEBUG -   - idx_transactions_effective_user_date
2025-09-25 11:33:15,335 - utils.safe_db_init - DEBUG -   - transactions_effective_pkey1
2025-09-25 11:33:15,336 - utils.safe_db_init - DEBUG -   - transactions_effective_tx_id_key1
2025-09-25 11:33:15,336 - utils.safe_db_init - DEBUG -   - ux_transactions_tx_id
2025-09-25 11:33:15,336 - utils.safe_db_init - INFO - user_corrections: 2 indexes
2025-09-25 11:33:15,336 - utils.safe_db_init - DEBUG -   - user_corrections_corr_id_key1
2025-09-25 11:33:15,339 - utils.safe_db_init - DEBUG -   - user_corrections_pkey1
2025-09-25 11:33:15,339 - utils.safe_db_init - INFO - user_rules: 4 indexes
2025-09-25 11:33:15,341 - utils.safe_db_init - DEBUG -   - idx_user_rules_rule_id
2025-09-25 11:33:15,341 - utils.safe_db_init - DEBUG -   - idx_user_rules_user_active
2025-09-25 11:33:15,341 - utils.safe_db_init - DEBUG -   - user_rules_pkey
2025-09-25 11:33:15,341 - utils.safe_db_init - DEBUG -   - user_rules_rule_id_key
2025-09-25 11:33:15,341 - utils.safe_db_init - INFO - z_archive_inference_snapshots_20250911: 6 indexes
2025-09-25 11:33:15,341 - utils.safe_db_init - DEBUG -   - idx_inference_snapshots_cc_id
2025-09-25 11:33:15,342 - utils.safe_db_init - DEBUG -   - idx_inference_snapshots_confidence
2025-09-25 11:33:15,343 - utils.safe_db_init - DEBUG -   - idx_inference_snapshots_intent_decision
2025-09-25 11:33:15,345 - utils.safe_db_init - DEBUG -   - idx_inference_snapshots_user_created
2025-09-25 11:33:15,345 - utils.safe_db_init - DEBUG -   - inference_snapshots_cc_id_key
2025-09-25 11:33:15,346 - utils.safe_db_init - DEBUG -   - inference_snapshots_pkey
2025-09-25 11:33:15,346 - utils.safe_db_init - INFO - z_archive_transactions_effective_20250911: 3 indexes
2025-09-25 11:33:15,347 - utils.safe_db_init - DEBUG -   - idx_transactions_effective_user_tx
2025-09-25 11:33:15,348 - utils.safe_db_init - DEBUG -   - transactions_effective_pkey
2025-09-25 11:33:15,348 - utils.safe_db_init - DEBUG -   - transactions_effective_tx_id_key
2025-09-25 11:33:15,351 - utils.safe_db_init - INFO - z_archive_user_corrections_20250911: 6 indexes
2025-09-25 11:33:15,351 - utils.safe_db_init - DEBUG -   - idx_user_corrections_corr_id
2025-09-25 11:33:15,351 - utils.safe_db_init - DEBUG -   - idx_user_corrections_tx_id
2025-09-25 11:33:15,351 - utils.safe_db_init - DEBUG -   - idx_user_corrections_user_created
2025-09-25 11:33:15,351 - utils.safe_db_init - DEBUG -   - idx_user_corrections_user_tx
2025-09-25 11:33:15,352 - utils.safe_db_init - DEBUG -   - user_corrections_corr_id_key
2025-09-25 11:33:15,352 - utils.safe_db_init - DEBUG -   - user_corrections_pkey
2025-09-25 11:33:17,695 - utils.safe_db_init - INFO - ✓ All required tables exist
2025-09-25 11:33:17,695 - utils.safe_db_init - INFO - ✓ Database schema validation completed (read-only mode)
2025-09-25 11:33:17,696 - utils.safe_db_init - INFO - ✓ Schema creation is now managed by Alembic migrations
2025-09-25 11:33:17,696 - app - INFO - ✓ Database schema validation completed (Alembic-managed)
2025-09-25 11:33:17,696 - app - INFO - Running database migrations with advisory lock...
2025-09-25 11:33:25,329 - app - INFO - ✓ Database migrations completed successfully
2025-09-25 11:33:25,618 - utils.schema_validator - DEBUG - Table 'expenses' validation passed
2025-09-25 11:33:25,851 - utils.schema_validator - DEBUG - Table 'users' validation passed
2025-09-25 11:33:25,851 - utils.schema_validator - INFO - Schema validation passed - all tables have required columns
2025-09-25 11:33:25,851 - app - INFO - ✓ Database schema validation passed
2025-09-25 11:33:25,852 - finbrain.pca_flags - INFO - PCA Feature Flags: overlay=True, mode=TRUE, audit_ui=True, rules=False, precedence=False
2025-09-25 11:33:25,860 - app - INFO - ✓ Audit API routes registered
2025-09-25 11:33:25,864 - app - INFO - ✓ Assets API routes registered
2025-09-25 11:33:26,020 - app - INFO - ✓ Data Integrity API routes registered
2025-09-25 11:33:26,028 - utils.single_writer_metrics - INFO - Single Writer Monitor initialized with SLA targets
2025-09-25 11:33:26,031 - app - INFO - ✓ Deploy Probe API routes registered
2025-09-25 11:33:26,031 - app - INFO - Attempting to register Redis smoke test endpoint...
2025-09-25 11:33:26,032 - app - INFO - Redis smoke test endpoint not loaded: No module named 'app.routes_redis_smoke'; 'app' is not a package
2025-09-25 11:33:26,032 - app - INFO - Background reports disabled (ENABLE_REPORTS=false)
2025-09-25 11:33:26,032 - app - INFO - Initializing background processor...
2025-09-25 11:33:26,042 - utils.circuit_breaker - INFO - Circuit breaker initialized: threshold=5, window=60s, timeout=30s
2025-09-25 11:33:26,045 - utils.job_queue - DEBUG - Raw REDIS_URL: REDIS_URL="rediss://default:ASuhAAIncDI4NzQzMjkzNj...
2025-09-25 11:33:26,045 - utils.job_queue - WARNING - Fixed REDIS_URL format: removed variable name prefix
2025-09-25 11:33:26,045 - utils.job_queue - WARNING - Fixed REDIS_URL format: removed quotes
2025-09-25 11:33:26,666 - utils.job_queue - INFO - Job queue initialized with Redis backend at new-grizzly-11169.upstash.io:6379
2025-09-25 11:33:26,671 - utils.job_processor - WARNING - Supabase storage not available for job results
2025-09-25 11:33:26,859 - utils.job_processor - INFO - Job processor initialized
2025-09-25 11:33:26,860 - utils.background_processor - INFO - Job queue integration enabled
2025-09-25 11:33:26,864 - utils.background_processor - INFO - Job queue worker started
2025-09-25 11:33:26,864 - utils.background_processor - INFO - Redis job queue worker started
2025-09-25 11:33:26,865 - utils.background_processor - INFO - Background processor initialized with 3 workers
2025-09-25 11:33:27,355 - app - INFO - Background processor ready: {'max_workers': 3, 'ai_enabled': True, 'processing_timeout': 5.0, 'message_queue_size': 0, 'job_queue_enabled': True, 'job_polling_active': True, 'redis_jobs_queued': 0, 'redis_jobs_retry': 0, 'redis_jobs_dlq': 0}
2025-09-25 11:33:27,356 - app - INFO - Initializing data integrity scheduler...
2025-09-25 11:33:27,362 - tzlocal - DEBUG - No explicit setting existed. Use localtime
2025-09-25 11:33:27,366 - apscheduler.scheduler - INFO - Adding job tentatively -- it will be properly scheduled when the scheduler starts
2025-09-25 11:33:27,372 - apscheduler.scheduler - INFO - Added job "Nightly Data Integrity Check" to job store "default"
2025-09-25 11:33:27,373 - apscheduler.scheduler - INFO - Scheduler started
2025-09-25 11:33:27,377 - apscheduler.scheduler - DEBUG - Looking for jobs to run
2025-09-25 11:33:27,377 - utils.integrity_scheduler - INFO - Data integrity scheduler started successfully
2025-09-25 11:33:27,378 - app - INFO - ✓ Data integrity scheduler started (nightly checks enabled)
2025-09-25 11:33:27,378 - apscheduler.scheduler - DEBUG - Next wakeup is due at 2025-09-26 02:00:00+00:00 (in 51992.621731 seconds)
2025-09-25 11:33:27,378 - app - INFO - {'startup_configuration': {'rate_limits': {'ai_rl_user_limit': 4, 'ai_rl_window_sec': 60, 'ai_rl_global_limit': 120}, 'app_constants': {'msg_max_chars': 280, 'timezone': 'Asia/Dhaka', 'currency_symbol': '৳'}, 'ux_enhancements': {'fallback_copy': 'Taking a quick breather to stay fast & free...', 'system_prompt': '2-3 sentences max, action-oriented', 'quick_replies': 'structured messaging enabled'}}}
2025-09-25 11:33:27,379 - app - INFO - Running cold-start mitigation...
2025-09-25 11:33:27,381 - utils.cold_start_mitigation - INFO - Starting cold-start mitigation warm-up sequence...
2025-09-25 11:33:27,389 - utils.cold_start_mitigation - INFO - DNS resolved generativelanguage.googleapis.com -> 142.250.71.106 in 7.89ms
2025-09-25 11:33:27,401 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): generativelanguage.googleapis.com:443
2025-09-25 11:33:29,005 - urllib3.connectionpool - DEBUG - https://generativelanguage.googleapis.com:443 "HEAD /v1beta/models HTTP/1.1" 404 0
2025-09-25 11:33:29,006 - utils.cold_start_mitigation - INFO - AI provider warm-up successful: 404 in 1616.64ms
2025-09-25 11:33:29,006 - utils.cold_start_mitigation - INFO - Cold-start mitigation completed successfully in 1625.18ms
2025-09-25 11:33:29,006 - app - INFO - Cold-start mitigation completed: {'started_at': '2025-09-25T11:33:27.381432', 'ai_enabled': True, 'dns_resolution': True, 'ai_warm_up': {'status': 'warmed', 'status_code': 404, 'response_time_ms': 1616.6431903839111, 'endpoint': 'https://generativelanguage.googleapis.com/v1beta/models'}, 'total_time_ms': 1625.1811981201172, 'success': True}
2025-09-25 11:33:29,019 - utils.health_ping - INFO - Health ping system started: http://localhost:5000/health every 300s
2025-09-25 11:33:29,268 - app - INFO - Coaching monitoring endpoints registered
2025-09-25 11:33:29,271 - app - INFO - Registered quickscan diagnostic endpoint at /ops/quickscan
2025-09-25 11:33:29,273 - utils.rate_limiter_jobs - INFO - Job rate limiter initialized: 60 jobs per hour
2025-09-25 11:33:29,275 - app - INFO - ✓ Job queue API endpoints registered
2025-09-25 11:33:29,284 - app - INFO - ✓ PWA UI routes registered (/chat, /report, /profile, /challenge, /offline)
2025-09-25 11:33:29,298 - app - INFO - ✓ Backend Assistant API routes registered (/api/backend/*)
2025-09-25 11:33:29,302 - app - INFO - ✓ Growth telemetry routes registered (/metrics, /admin/metrics)
2025-09-25 11:33:29,306 - app - INFO - ✓ Single Writer Observability routes registered (/ops/single-writer/*, /admin/single-writer/*)
2025-09-25 11:33:29,307 - app - INFO - ✓ Service Worker diagnostics registered (/ops/sw-diagnostics)
