BLOCK 2 â€” Rule-based Milestone Inserts (Prompt Version)
ğŸ¯ Goal

Introduce simple milestone messages (streaks, logging count, spending spikes/wins) to increase user motivation and create moments of recognition.

âœ… What the Agent Must Do

Milestones to Implement

Streak-3: When user logs 3 days in a row â†’ message: â€œğŸ”¥ 3-day streak! Youâ€™re building a habit.â€

10 Logs: When user reaches 10 total logs â†’ message: â€œğŸ‰ 10th log! Thatâ€™s consistency.â€

Category Spike: If a categoryâ€™s spending jumps â‰¥25% compared to last period â†’ message: â€œâš ï¸ Food spend spiked 25%â€”notice anything?â€

Small Win: If a categoryâ€™s spending drops â‰¥10% â†’ message: â€œğŸ‘ Transport down 15%â€”nice restraint.â€

Trigger Points

Immediately after a log is saved â†’ check for streak and total logs.

Once per day (end-of-day) â†’ check for category spikes/wins.

User Experience

Only one milestone message per trigger (to avoid spam).

Messages appear inline in the chat like a coach speaking up.

If no milestone, no extra message.

Telemetry

Each fired milestone must log a signal:

Example: { "milestone": "streak-3", "user": "<id>", "source": "post-log" }

âš ï¸ Risks (for stakeholder review before build)

Race Conditions

If user logs many expenses very quickly, they might trigger duplicate milestones.

Mitigation: Ensure each milestone fires only once per user.

Performance

Checking categories after every log may slow things down.

Mitigation: Run simple checks immediately (streak, log count). Run heavier comparisons (spike/win) once per day only.

User Confusion

Spending â€œspikesâ€ or â€œwinsâ€ based on too little data can feel random.

Mitigation: Only trigger when at least 3 expenses exist in that category.

Message Fatigue

Too many milestone messages could annoy users.

Mitigation: Cap at 1 milestone message per day.

ğŸ›  Prompt to the AI Agent
You are responsible for milestone coaching messages in FinBrain. 
Implement 4 rules: streak-3, 10-logs, category-spike, small-win. 

- Trigger streak-3 and 10-logs immediately after expense logging. 
- Trigger category-spike and small-win once daily, based on category comparisons. 
- Insert exactly one milestone message per trigger, max 1 per day. 
- Ensure each milestone fires only once per user lifetime. 
- Log telemetry with milestone name, user ID, and trigger source. 
- Skip if conditions are not met (e.g., too few data points). 

Output: a short motivational system message injected into chat. 
